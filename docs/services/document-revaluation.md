# DocumentRevaluation (Изменение цен)

Сервис для управления розничными и оптовыми ценами.

## Типы документов

1.  **Ручной (Manual)**: Создается менеджером для планового изменения цен (например, сезонная скидка).
2.  **Автоматический (Generated)**: Создается автоматически при проведении Закупки (`DocumentPurchase`), если закупочная цена изменилась и пользователь выбрал опцию "Обновить цены продажи".

## Методы

### `create`

Создание черновика.

### `addItems` / `updateItem`

- Указывается `productId`, `priceTypeId` и `newValue`.
- `oldValue` подтягивается автоматически из текущего прайс-листа для справки.

### `updateStatus(COMPLETED)`

1.  **Ledger**: Создает записи в `PriceLedger` (история цен).
2.  **Update**: Обновляет таблицу `Price` (текущие актуальные цены). Теперь при продаже будет использоваться новая цена.

## Связь с Закупкой

Если документ создан автоматически из Закупки:

- Его нельзя редактировать вручную напрямую.
- При добавлении новых позиций в закупку с новыми ценами, они автоматически добавляются (агрегируются) в этот же документ переоценки.
- Его статус жестко связан со статусом Закупки (Закупка проведена -> Цены обновлены. Закупка отменена -> Цены возвращены).
- Это гарантирует, что если вы отменили ошибочную накладную, цены тоже вернутся в исходное состояние.

# Глоссарий терминов

В этой документации используются технические термины, касающиеся баз данных и логики складского учета. Ниже приведено их описание.

---

## Складской учет

### WAP (Weighted Average Price)
**Средневзвешенная цена закупки**. 
Это метод оценки себестоимости товаров. Вместо того чтобы отслеживать каждую конкретную единицу товара (например, по серийному номеру), система высчитывает среднюю цену.
*   **Зачем это нужно?** Когда вы покупаете одну партию товара по $100, а вторую по $120, система вычисляет среднюю цену (например, $110). Эта цена используется как "себестоимость" при продаже для расчета прибыли.

### Sequence Reprocessing (Последовательный пересчет)
**Механизм восстановления истории цен.**
Так как WAP зависит от хронологического порядка операций, любое изменение в прошлом (например, отмена закупки недельной давности) требует пересчета всех последующих документов.
*   **Как работает:** Система находит измененный документ, "откатывается" к состоянию на эту дату и заново проигрывает все последующие движения (продажи, перемещения), обновляя в них себестоимость. Это позволяет поддерживать корректную отчетность даже при ошибках операторов задним числом.

### Fallback WAP
**Запасная себестоимость**. 
Логика поиска цены, когда на текущем складе её нет. 
*   **Пример:** Клиент возвращает товар на новый склад, где этот товар никогда не продавался. Система не знает его себестоимость. Она "заглядывает" на другие склады, находит цену там и использует её как подсказку, чтобы не оприходовать товар по нулевой цене.

---

## Базы данных (Изоляция транзакций)

Транзакции позволяют выполнять несколько действий в БД как одно целое. Если одно действие упало — откатываются все. Уровни изоляции определяют, как параллельные транзакции видят изменения друг друга.

### ReadCommitted
**Чтение зафиксированных данных**. 
Стандартный уровень изоляции. Транзакция видит только те данные, которые уже были "зафиналены" (committed) другими пользователями.
*   **Использование:** Применяется в продажах. Нам важно видеть актуальный остаток, но строгая очередь выполнения не критична.

### Serializable
**Последовательный уровень**. 
Самый строгий уровень изоляции. БД гарантирует такой результат, как если бы транзакции выполнялись строго по очереди, одна за другой.
*   **Использование:** Применяется при закупках и расчете WAP. Если два человека одновременно оприходуют один и тот же товар, Serializable заставит их подождать друг друга. Это исключает риск того, что они оба прочитают старую цену и неправильно посчитают среднюю.

### Snapshot (Снимок)
Копия данных в конкретный момент времени.
*   В системе аудита (`StockMovement`) мы сохраняем "снимки" остатка и цены после каждой операции. Это позволяет нам не только знать текущий остаток, но и восстановить историю: "Сколько штук и по какой цене было на складе ровно месяц назад?".

### Upsert (Update + Insert)
Операция в БД: "Если запись существует — обнови её, если нет — создай новую". Применяется для управления остатками на складах.
